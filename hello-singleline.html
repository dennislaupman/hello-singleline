<!DOCTYPE html>
<html ng-app="helloSingleLine">
<head>
	<title>Hello... Realtime collaboration editor</title>


	<style type="text/css">

	body {
		margin: 0;
		padding: 0; 
	}

	#checkselectionwidth,
	#checkselectionoffset,
	[hello] {

		
		width: 600px;
		line-height: 24px;
		padding: 10px;
		box-sizing: border-box;
		font-family: verdana;
		font-size: 14px;
		margin:0;
		height: 44px;
		overflow: hidden;
	}

	#checkselectionoffset,
	#checkselectionwidth {

		background: #ff00ff;
		padding: 0;
		margin: 0; 
		visibility: hidden;
	}

	[hello] div:first-child {

		z-index: 2;
		position: relative;
	}

	.selection {

		height:24px;
		width: 0;
		background: #86be40;
		opacity: 0.35;
		position: relative;
		top: -24px;
		z-index: 0;
	}

	.selection.blue {

		background: #54bed3;
	}

	.selection.pink {

		background: #f062a4;
	}

	.selection.yellow {

		background: #ffd33a;
	}

	#move {

	
		
		padding: 0;
		margin: 0; 
	}

	.hide {

		display: none;
	}

	</style>
</head>
<body  ng-controller="helloSingleLineCtrl as Ctrl">

	<div hello ng-click="Ctrl.selectRange()">
		<div id="bla">Lorem Ipsum is slechts een proeftekst uit het drukkerij- en zetterijwezen. </div>
		<div class="selection"></div>
	</div>


		<span id="checkselectionwidth"></span>
		<span id="checkselectionoffset"></span>
 
	<br />
	<!-- dont remove br -->

	Pick a color: 
	<select id="color">
		<option value="green">Green</option>
		<option value="blue">Blue</option>
		<option value="pink">Pink</option>
		<option value="yellow">yellow</option>
	</select>

<p>
	
	<button id="showArray">showArray</button>
</p>
	

	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
	<script src='/socket.io/socket.io.js'></script>

	<script type="text/javascript">

		var app = angular.module('helloSingleLine', [])
  			app.controller('helloSingleLineCtrl', function() {
   
				var previousColor = 'green'

				var connectedClients = [];
				var sockedId =null

			   	var socket = io();
		            socket.on('connectedClients', function(data) {
		              
						connectedClients = data.connectedClients;

						console.log('connectedClients', data.connectedClients);
		            });


		             socket.on('getSocketId', function(data) {
		              
						sockedId = data.socketId;

						console.log('getSocketId', sockedId);
		            });


		           
		            socket.on('getSelectionRange',  function(data) {

		            	var rce =  document.querySelector( '.selection' );

						angular.element( rce )
							.removeClass(previousColor)
							.addClass( data.color )
							.css( 'left', data.left + 'px')
							.css( 'width', data.width +'px');

						previousColor = data.color;
		            });

		          
			this.selectRange = function( event ) {

				var selObj = window.getSelection(); 	
				var checkselectionwidth = document.querySelector( '#checkselectionwidth' );
				var checkselectionoffset = document.querySelector( '#checkselectionoffset' );
				var bla = document.querySelector( '#bla' );
				var color = document.querySelector( '#color' );

				angular.element( checkselectionwidth ).html(selObj.toString());
				angular.element( checkselectionoffset ).html(angular.element( bla ).html().toString().substring(0, selObj.getRangeAt(0).startOffset));

			
				console.log( document.querySelector( '#checkselectionwidth' ).offsetWidth )

				 socket.emit('setSelectionRange', {

				 	'color': angular.element( color ).val() ||  'green',
				 	'left': checkselectionoffset.offsetWidth, 
					'width': checkselectionwidth.offsetWidth
				 });
			};

	});


	</script>

</body>
</html>